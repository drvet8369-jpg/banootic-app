
-- Enable RLS for all tables
ALTER TABLE "providers" ENABLE ROW LEVEL SECURITY;
ALTER TABLE "customers" ENABLE ROW LEVEL SECURITY;
ALTER TABLE "reviews" ENABLE ROW LEVEL SECURITY;
ALTER TABLE "agreements" ENABLE ROW LEVEL SECURITY;

-- Drop existing policies to avoid conflicts
DROP POLICY IF EXISTS "Allow public read access to providers" ON "providers";
DROP POLICY IF EXISTS "Allow public read access to customers" ON "customers";
DROP POLICY IF EXISTS "Allow public read access to reviews" ON "reviews";
DROP POLICY IF EXISTS "Allow public read access to agreements" ON "agreements";
DROP POLICY IF EXISTS "Allow insert for agreements" ON "agreements";
DROP POLICY IF EXISTS "Allow insert for reviews" ON "reviews";
DROP POLICY IF EXISTS "Allow insert for customers" ON "customers";
DROP POLICY IF EXISTS "Allow insert for providers" ON "providers";
DROP POLICY IF EXISTS "Allow update for providers" ON "providers";
DROP POLICY IF EXISTS "Allow update for agreements" ON "agreements";


-- Create policies to allow public read access for all users
CREATE POLICY "Allow public read access to providers" ON "providers" FOR SELECT USING (true);
CREATE POLICY "Allow public read access to customers" ON "customers" FOR SELECT USING (true);
CREATE POLICY "Allow public read access to reviews" ON "reviews" FOR SELECT USING (true);
CREATE POLICY "Allow public read access to agreements" ON "agreements" FOR SELECT USING (true);

-- Allow all operations for users with the service_role key (bypasses RLS)
-- The following policies ensure that authenticated actions from our backend work correctly.
CREATE POLICY "Allow insert for agreements" ON "agreements" FOR INSERT WITH CHECK (true);
CREATE POLICY "Allow insert for reviews" ON "reviews" FOR INSERT WITH CHECK (true);
CREATE POLICY "Allow insert for customers" ON "customers" FOR INSERT WITH CHECK (true);
CREATE POLICY "Allow insert for providers" ON "providers" FOR INSERT WITH CHECK (true);
CREATE POLICY "Allow update for providers" ON "providers" FOR UPDATE USING (true) WITH CHECK (true);
CREATE POLICY "Allow update for agreements" ON "agreements" FOR UPDATE USING (true) WITH CHECK (true);
